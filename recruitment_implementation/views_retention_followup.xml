<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ================================================================== -->
    <!-- RETENTION VIEWS -->
    <!-- ================================================================== -->

    <!-- Tree View: Retention List -->
    <record id="view_recruitment_retention_tree" model="ir.ui.view">
        <field name="name">recruitment.retention.tree</field>
        <field name="model">recruitment.retention</field>
        <field name="arch" type="xml">
            <tree string="Placements Retention" decoration-danger="risk_level == 'critical'" decoration-warning="risk_level == 'high'">
                <field name="name"/>
                <field name="candidate_id"/>
                <field name="partner_id"/>
                <field name="retention_amount" sum="total"/>
                <field name="retention_release_date"/>
                <field name="retention_status"/>
                <field name="days_until_release"/>
                <field name="risk_level"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <!-- Form View: Retention (Fully Responsive) -->
    <record id="view_recruitment_retention_form" model="ir.ui.view">
        <field name="name">recruitment.retention.form</field>
        <field name="model">recruitment.retention</field>
        <field name="arch" type="xml">
            <form string="Placement Retention">
                <!-- Status Bar -->
                <header>
                    <button name="action_activate" string="üöÄ Activate" type="object" class="oe_highlight" states="draft"/>
                    <button name="action_mark_upfront_paid" string="‚úì Upfront Paid" type="object" states="active"/>
                    <button name="action_release_retention" string="üì§ Release" type="object" class="oe_highlight" states="active"/>
                    <button name="action_mark_retention_paid" string="üí≥ Retention Paid" type="object" class="oe_highlight" states="released"/>
                    <button name="action_forfeit_retention" string="‚ö†Ô∏è Forfeit" type="object" states="active,released"/>
                    <button name="action_cancel" string="‚ùå Cancel" type="object" states="draft,active,released"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,active,released,completed,forfeited"/>
                </header>

                <sheet>
                    <!-- Title Section -->
                    <div class="oe_title">
                        <h1 class="d-flex align-items-baseline" style="gap: 12px;">
                            <field name="name" readonly="1" class="me-2"/>
                            <field name="risk_level" widget="badge" attrs="{'invisible': [('state', '=', 'draft')]}" class="badge badge-danger" decoration-danger="risk_level == 'critical'" decoration-warning="risk_level == 'high'" decoration-info="risk_level in ['low', 'medium']"/>
                        </h1>
                    </div>

                    <!-- Critical Risk Alert -->
                    <div class="alert alert-danger alert-dismissible fade show" role="alert" attrs="{'invisible': [('risk_level', '!=', 'critical')]}">
                        <strong class="me-2">‚ö†Ô∏è CRITICAL RISK</strong>
                        Retention at high risk of forfeiture!
                        <div class="mt-2">
                            <field name="risk_notes" readonly="1" nolabel="1"/>
                        </div>
                    </div>

                    <!-- High Risk Alert -->
                    <div class="alert alert-warning alert-dismissible fade show" role="alert" attrs="{'invisible': [('risk_level', '!=', 'high')]}">
                        <strong class="me-2">‚ö†Ô∏è HIGH RISK</strong>
                        Close monitoring required
                    </div>

                    <!-- ============================================================ -->
                    <!-- SECTION 1: Key Information (Responsive Grid) -->
                    <!-- ============================================================ -->
                    <div class="row" style="margin-bottom: 24px;">
                        <div class="col-md-6 col-lg-3">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label fw-bold">Candidate</label>
                                <field name="candidate_id" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label fw-bold">Client</label>
                                <field name="partner_id" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label fw-bold">Deployment</label>
                                <field name="deployment_id" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label fw-bold">Placement Date</label>
                                <field name="placement_date" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================================ -->
                    <!-- SECTION 2: Financial Information (2-Column Responsive) -->
                    <!-- ============================================================ -->
                    <group string="üí∞ Placement Fee &amp; Retention" name="financial">
                        <group col="6">
                            <field name="total_placement_fee"/>
                            <field name="currency_id"/>
                        </group>
                        <group col="6">
                            <field name="upfront_percentage" widget="percentage"/>
                            <field name="retention_percentage" readonly="1"/>
                        </group>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 3: Payment Tracking (Responsive Cards) -->
                    <!-- ============================================================ -->
                    <group string="üí≥ Payment Tracking" name="payments">
                        <!-- Upfront Payment -->
                        <group col="12" style="background: #f8f9fa; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                            <h5 class="mb-3">Upfront Payment (
                                <field name="upfront_percentage" readonly="1" nolabel="1" style="display:inline; width: auto;"/>
%)</h5>
                            <group col="6">
                                <field name="upfront_amount" readonly="1"/>
                                <field name="upfront_paid" widget="boolean_toggle"/>
                            </group>
                            <group col="6">
                                <field name="upfront_payment_date" attrs="{'invisible': [('upfront_paid', '=', False)]}"/>
                            </group>
                        </group>

                        <!-- Retention Payment -->
                        <group col="12" style="background: #fff8e1; padding: 12px; border-radius: 4px;">
                            <h5 class="mb-3">Retention Payment (
                                <field name="retention_percentage" readonly="1" nolabel="1" style="display:inline; width: auto;"/>
%)</h5>
                            <group col="6">
                                <field name="retention_amount" readonly="1"/>
                                <field name="retention_status"/>
                            </group>
                            <group col="6">
                                <field name="retention_paid" widget="boolean_toggle"/>
                                <field name="retention_payment_date" attrs="{'invisible': [('retention_paid', '=', False)]}"/>
                            </group>
                        </group>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 4: Retention Period (Timeline View) -->
                    <!-- ============================================================ -->
                    <group string="üìÖ Retention Period &amp; Timeline" name="period">
                        <group col="6">
                            <field name="retention_period_days"/>
                            <field name="retention_release_date" readonly="1"/>
                        </group>
                        <group col="6">
                            <field name="candidate_working_days" readonly="1"/>
                            <field name="days_until_release" readonly="1" widget="integer"/>
                        </group>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 5: Candidate Stability (With Status) -->
                    <!-- ============================================================ -->
                    <group string="üë§ Candidate Stability Tracking" name="candidate_stability">
                        <group col="6">
                            <field name="candidate_status"/>
                        </group>
                        <group col="6">
                            <field name="has_replacement_guarantee"/>
                        </group>
                        <group col="12" attrs="{'invisible': [('replacement_count', '=', 0)]}">
                            <field name="replacement_count"/>
                        </group>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 6: Forfeiture Details (Conditional) -->
                    <!-- ============================================================ -->
                    <group string="‚õî Forfeiture Details" name="forfeiture" attrs="{'invisible': [('state', '!=', 'forfeited')]}">
                        <group col="6">
                            <field name="forfeiture_reason"/>
                            <field name="forfeiture_date"/>
                        </group>
                        <group col="12">
                            <field name="forfeiture_notes" nolabel="1"/>
                        </group>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 7: Additional Info -->
                    <!-- ============================================================ -->
                    <group string="üìé Additional Information" name="additional">
                        <group col="6">
                            <field name="invoice_id"/>
                        </group>
                    </group>
                </sheet>

                <!-- Chatter Section (Activities &amp; Comments) -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Kanban View: Retention by Risk -->
    <record id="view_recruitment_retention_kanban" model="ir.ui.view">
        <field name="name">recruitment.retention.kanban</field>
        <field name="model">recruitment.retention</field>
        <field name="arch" type="xml">
            <kanban default_group_by="risk_level" quick_create="false">
                <field name="name"/>
                <field name="candidate_id"/>
                <field name="retention_amount"/>
                <field name="days_until_release"/>
                <field name="candidate_status"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card">
                            <div class="oe_kanban_details">
                                <strong>
                                    <field name="candidate_id"/>
                                </strong>
                                <br/>
                                <field name="partner_id"/>
                                <br/>
                                Retention: 
                                <field name="retention_amount" widget="monetary"/>
                            </div>
                            <div class="oe_kanban_footer">
                                Release in: 
                                <field name="days_until_release"/>
 days
                                <br/>
                                Status: 
                                <field name="candidate_status"/>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Action: View All Retentions -->
    <record id="action_recruitment_retention_all" model="ir.actions.act_window">
        <field name="name">Placements Retention</field>
        <field name="res_model">recruitment.retention</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="help">Track placement retention periods and manage retention payments</field>
    </record>

    <!-- Action: Active Retentions Only -->
    <record id="action_recruitment_retention_active" model="ir.actions.act_window">
        <field name="name">Active Retentions</field>
        <field name="res_model">recruitment.retention</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('state', '=', 'active')]</field>
    </record>

    <!-- Action: At-Risk Retentions -->
    <record id="action_recruitment_retention_atrisk" model="ir.actions.act_window">
        <field name="name">At-Risk Retentions</field>
        <field name="res_model">recruitment.retention</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('risk_level', 'in', ['high', 'critical'])]</field>
    </record>

    <!-- ================================================================== -->
    <!-- FOLLOW-UP VIEWS -->
    <!-- ================================================================== -->

    <!-- Tree View: Follow-ups -->
    <record id="view_recruitment_followup_tree" model="ir.ui.view">
        <field name="name">recruitment.followup.tree</field>
        <field name="model">recruitment.followup</field>
        <field name="arch" type="xml">
            <tree string="Follow-Ups" decoration-danger="retention_at_risk" decoration-warning="days_overdue > 0">
                <field name="name"/>
                <field name="candidate_id"/>
                <field name="followup_type"/>
                <field name="scheduled_date"/>
                <field name="completed_date"/>
                <field name="days_overdue"/>
                <field name="issue_severity"/>
                <field name="retention_at_risk" widget="boolean"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <!-- Form View: Follow-up (Fully Responsive) -->
    <record id="view_recruitment_followup_form" model="ir.ui.view">
        <field name="name">recruitment.followup.form</field>
        <field name="model">recruitment.followup</field>
        <field name="arch" type="xml">
            <form string="Post-Placement Follow-Up">
                <!-- Action Buttons -->
                <header>
                    <button name="action_start" string="‚ñ∂Ô∏è Start Follow-Up" type="object" class="oe_highlight" states="scheduled"/>
                    <button name="action_complete" string="‚úì Complete Follow-Up" type="object" class="oe_highlight" states="in_progress"/>
                    <button name="action_escalate_to_management" string="üîî Escalate" type="object" states="scheduled,in_progress"/>
                    <button name="action_schedule_next_followup" string="üìÖ Schedule Next" type="object" states="completed"/>
                    <button name="action_cancel" string="‚úï Cancel" type="object" states="scheduled,in_progress"/>
                    <field name="state" widget="statusbar" statusbar_visible="scheduled,in_progress,completed,cancelled"/>
                </header>

                <sheet>
                    <!-- Critical Alert: Retention at Risk -->
                    <div class="alert alert-danger alert-dismissible fade show" role="alert" attrs="{'invisible': [('retention_at_risk', '=', False)]}">
                        <strong class="me-2">‚ö†Ô∏è RETENTION AT RISK</strong>
                        Issues detected that may impact retention amount!
                        <br/>
                        <small>Immediate follow-up and escalation recommended.</small>
                    </div>

                    <!-- Overdue Alert -->
                    <div class="alert alert-warning alert-dismissible fade show" role="alert" attrs="{'invisible': [('days_overdue', '&lt;=', 0)]}">
                        <strong class="me-2">‚è∞ OVERDUE</strong>
                        This follow-up is <field name="days_overdue" readonly="1" nolabel="1" style="display:inline; width:auto;"/>
 days overdue!
                    </div>

                    <!-- Title Section -->
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1" class="me-3"/>
                            <field name="followup_type" widget="badge" readonly="1" class="badge badge-info"/>
                        </h1>
                    </div>

                    <!-- ============================================================ -->
                    <!-- SECTION 1: Key Information (Responsive Grid) -->
                    <!-- ============================================================ -->
                    <div class="row" style="margin-bottom: 24px;">
                        <div class="col-md-6 col-lg-3">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label fw-bold">Candidate</label>
                                <field name="candidate_id" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label fw-bold">Client</label>
                                <field name="partner_id" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label fw-bold">Deployment</label>
                                <field name="deployment_id" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label fw-bold">Follow-Up Type</label>
                                <field name="followup_type" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================================ -->
                    <!-- SECTION 2: Scheduling Information -->
                    <!-- ============================================================ -->
                    <group string="üìÖ Scheduling Information" name="schedule">
                        <group col="6">
                            <field name="scheduled_date"/>
                            <field name="days_overdue" readonly="1"/>
                        </group>
                        <group col="6">
                            <field name="completed_date" attrs="{'invisible': [('state', 'in', ['scheduled', 'in_progress'])]}"/>
                            <field name="state" readonly="1"/>
                        </group>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 3: Candidate Status (With Visual Indicators) -->
                    <!-- ============================================================ -->
                    <group string="üë§ Candidate Status at Follow-Up" name="status">
                        <group col="6">
                            <label string="Is candidate still working?" class="fw-bold"/>
                            <field name="candidate_working" widget="boolean_toggle" nolabel="1" style="margin-bottom: 12px;"/>
                        </group>
                        <group col="6">
                            <field name="candidate_location"/>
                        </group>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 4: Issue Tracking (Conditional) -->
                    <!-- ============================================================ -->
                    <group string="‚ö†Ô∏è Issues &amp; Concerns" name="issues">
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 4px; width: 100%;">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Are there any issues?</label>
                                <field name="issue_reported" widget="boolean_toggle" nolabel="1"/>
                            </div>

                            <div attrs="{'invisible': [('issue_reported', '=', False)]}">
                                <group col="12">
                                    <group col="6">
                                        <field name="issue_severity" attrs="{'invisible': [('issue_reported', '=', False)]}"/>
                                    </group>
                                    <group col="6">
                                        <field name="issue_category" attrs="{'invisible': [('issue_reported', '=', False)]}"/>
                                    </group>
                                </group>
                                <group col="12">
                                    <field name="issue_description" nolabel="1" colspan="2"/>
                                </group>
                            </div>
                        </div>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 5: Contact Details -->
                    <!-- ============================================================ -->
                    <group string="üìû Follow-Up Contact Details" name="contact">
                        <group col="6">
                            <field name="contact_method"/>
                            <field name="contact_person"/>
                        </group>
                        <group col="12">
                            <label class="form-label fw-bold">Contact Notes</label>
                            <field name="contact_notes" nolabel="1" placeholder="Document how you contacted candidate and what they said..."/>
                        </group>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 6: Next Actions (Conditional) -->
                    <!-- ============================================================ -->
                    <group string="‚û°Ô∏è Next Actions Required" name="actions">
                        <div style="background: #fff8e1; padding: 12px; border-radius: 4px; width: 100%;">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Is further action needed?</label>
                                <field name="next_action_required" widget="boolean_toggle" nolabel="1"/>
                            </div>

                            <div attrs="{'invisible': [('next_action_required', '=', False)]}">
                                <group col="12">
                                    <group col="6">
                                        <field name="next_action_type"/>
                                    </group>
                                    <group col="6">
                                        <field name="recommended_by"/>
                                    </group>
                                </group>
                                <group col="12">
                                    <label class="form-label fw-bold">Action Details</label>
                                    <field name="next_action_notes" nolabel="1" placeholder="Describe what action is needed and why..."/>
                                </group>
                            </div>
                        </div>
                    </group>

                    <!-- ============================================================ -->
                    <!-- SECTION 7: Risk Assessment -->
                    <!-- ============================================================ -->
                    <group string="üéØ Risk Assessment" name="risk">
                        <group col="6">
                            <label class="form-label fw-bold">Retention at Risk?</label>
                            <field name="retention_at_risk" readonly="1" widget="boolean_toggle" nolabel="1"/>
                        </group>
                        <group col="6">
                            <field name="retention_id" readonly="1" attrs="{'invisible': [('retention_id', '=', False)]}"/>
                        </group>
                    </group>
                </sheet>

                <!-- Chatter Section (Activities &amp; Comments) -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Calendar View: Follow-ups by Scheduled Date -->
    <record id="view_recruitment_followup_calendar" model="ir.ui.view">
        <field name="name">recruitment.followup.calendar</field>
        <field name="model">recruitment.followup</field>
        <field name="arch" type="xml">
            <calendar string="Follow-Up Schedule" date_start="scheduled_date" color="followup_type">
                <field name="candidate_id"/>
                <field name="followup_type"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>

    <!-- Action: View All Follow-ups -->
    <record id="action_recruitment_followup_all" model="ir.actions.act_window">
        <field name="name">Post-Placement Follow-Ups</field>
        <field name="res_model">recruitment.followup</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="help">Track post-placement follow-ups and monitor candidate stability</field>
    </record>

    <!-- Action: Scheduled Follow-ups -->
    <record id="action_recruitment_followup_scheduled" model="ir.actions.act_window">
        <field name="name">Scheduled Follow-Ups</field>
        <field name="res_model">recruitment.followup</field>
        <field name="view_mode">tree,calendar,form</field>
        <field name="domain">[('state', '=', 'scheduled')]</field>
    </record>

    <!-- Action: Overdue Follow-ups -->
    <record id="action_recruitment_followup_overdue" model="ir.actions.act_window">
        <field name="name">Overdue Follow-Ups</field>
        <field name="res_model">recruitment.followup</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state', '=', 'scheduled'), ('days_overdue', '>', 0)]</field>
    </record>

    <!-- ================================================================== -->
    <!-- SEQUENCES -->
    <!-- ================================================================== -->

    <record id="seq_recruitment_retention" model="ir.sequence">
        <field name="name">Recruitment Retention</field>
        <field name="code">recruitment.retention</field>
        <field name="prefix">RET/</field>
        <field name="padding">5</field>
        <field name="number_next">1</field>
    </record>

    <record id="seq_recruitment_followup" model="ir.sequence">
        <field name="name">Recruitment Follow-up</field>
        <field name="code">recruitment.followup</field>
        <field name="prefix">FUP/</field>
        <field name="padding">5</field>
        <field name="number_next">1</field>
    </record>

    <!-- ================================================================== -->
    <!-- MENU ITEMS -->
    <!-- ================================================================== -->

    <!-- Parent menu item -->
    <menuitem id="menu_recruitment_retention_parent" name="Retention Management" parent="menu_recruitment_management" sequence="50"/>

    <!-- Retention submenu -->
    <menuitem id="menu_recruitment_retention" name="Placements Retention" parent="menu_recruitment_retention_parent" action="action_recruitment_retention_all" sequence="10"/>

    <menuitem id="menu_recruitment_retention_active" name="Active Retentions" parent="menu_recruitment_retention_parent" action="action_recruitment_retention_active" sequence="20"/>

    <menuitem id="menu_recruitment_retention_atrisk" name="At-Risk Retentions" parent="menu_recruitment_retention_parent" action="action_recruitment_retention_atrisk" sequence="30"/>

    <!-- Follow-up submenu -->
    <menuitem id="menu_recruitment_followup_parent" name="Follow-Up Management" parent="menu_recruitment_management" sequence="60"/>

    <menuitem id="menu_recruitment_followup" name="All Follow-Ups" parent="menu_recruitment_followup_parent" action="action_recruitment_followup_all" sequence="10"/>

    <menuitem id="menu_recruitment_followup_scheduled" name="Scheduled Follow-Ups" parent="menu_recruitment_followup_parent" action="action_recruitment_followup_scheduled" sequence="20"/>

    <menuitem id="menu_recruitment_followup_overdue" name="Overdue Follow-Ups" parent="menu_recruitment_followup_parent" action="action_recruitment_followup_overdue" sequence="30"/>

</odoo>
