<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="report_payment_voucher_qr" model="ir.actions.report">
            <field name="name">Payment Voucher QR</field>
            <field name="model">account.payment</field>
            <field name="report_type">qweb-html</field>
          <field name="report_name">ingenuity_invoice_qr_code.report_payment_voucher_qr_document</field>
          <field name="report_file">ingenuity_invoice_qr_code.report_payment_voucher_qr_document</field>
            <field name="print_report_name">'Payment Voucher - %s' % (object.name)</field>
        </record>

        <template id="report_payment_voucher_qr_document" name="Payment Voucher QR Report">
          <t t-name="ingenuity_invoice_qr_code.report_payment_voucher_qr_document">
                <t t-call="web.html_container">
                    <t t-foreach="docs" t-as="payment">
                        <div class="page">
                            <style type="text/css">
              /* ===== ENHANCED A4 OPTIMIZED PAYMENT VOUCHER - STRICT SINGLE PAGE ===== */
              
              @page { 
                  margin: 0mm; 
                  size: A4; 
              }
              
              * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
              }
              
              .pv-wrapper {
                width: 210mm;
                height: 297mm;
                margin: 0 auto;
                border: 3px solid #6B1F35;
                font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
                font-size: 11px;
                color: #2C2C2C;
                line-height: 1.4;
                background: white;
                display: flex;
                flex-direction: column;
                page-break-after: avoid;
                page-break-inside: avoid;
              }
              
              .document-header {
                padding: 15px 20px;
                border-bottom: 3px solid #6B1F35;
                margin-bottom: 12px;
                background: linear-gradient(to bottom, #FAF5F7 0%, white 100%);
                page-break-inside: avoid;
              }
              
              .header-table {
                width: 100%;
                border-collapse: collapse;
              }
              
              .title-info {
                width: 60%;
                vertical-align: top;
                padding-right: 15px;
              }
              
              .company-name {
                font-size: 22px;
                font-weight: 700;
                color: #6B1F35;
                margin-bottom: 4px;
                letter-spacing: 0.8px;
                line-height: 1.2;
              }
              
              .document-title {
                font-size: 18px;
                font-weight: 800;
                color: #4A1525;
                text-transform: uppercase;
                letter-spacing: 1.5px;
                margin-bottom: 4px;
                line-height: 1.1;
              }
              
              .document-number {
                font-size: 13px;
                color: #6B1F35;
                font-weight: 600;
                padding: 4px 10px;
                background: white;
                border-left: 4px solid #6B1F35;
                display: inline-block;
                margin-top: 3px;
              }
              
              .qr-section {
                width: 40%;
                text-align: center;
                vertical-align: top;
              }
              
              .qr-container {
                margin-bottom: 8px;
              }
              
              .qr-code-large {
                width: 85px;
                height: 85px;
                border: 3px solid #6B1F35;
                background: white;
                padding: 3px;
                border-radius: 4px;
                display: block;
                margin: 0 auto;
              }
              
              .qr-placeholder-large {
                width: 85px;
                height: 85px;
                border: 3px dashed #6B1F35;
                background: #FAF5F7;
                line-height: 79px;
                text-align: center;
                font-size: 11px;
                color: #6B1F35;
                font-weight: 700;
                border-radius: 4px;
                margin: 0 auto;
              }
              
              .status-badge-container {
                text-align: center;
                margin-top: 6px;
              }
              
              .status-badge {
                display: inline-block;
                font-size: 10px;
                padding: 5px 12px;
                font-weight: 700;
                text-transform: uppercase;
                color: white;
                border-radius: 3px;
                letter-spacing: 0.8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.25);
              }
              
              .status-badge.completed {
                background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
              }
              
              .status-badge.draft {
                background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
              }
              
              .status-badge.cancelled {
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
              }
              
              .status-badge.pending {
                background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
              }
              
              .pv-body {
                padding: 0 20px 15px 20px;
                flex: 1;
                overflow: hidden;
              }
              
              .info-grid {
                width: 100%;
                margin-bottom: 12px;
                border-collapse: separate;
                border-spacing: 0 6px;
              }
              
              .info-row {
                width: 100%;
              }
              
              .info-cell {
                width: 50%;
                vertical-align: top;
                padding: 0 6px;
              }
              
              .info-item {
                margin-bottom: 8px;
              }
              
              .info-label {
                font-size: 10px;
                color: #6B1F35;
                text-transform: uppercase;
                font-weight: 700;
                margin-bottom: 2px;
                letter-spacing: 0.7px;
              }
              
              .info-value {
                font-size: 12px;
                color: #2C2C2C;
                padding: 6px 10px;
                background: #FAF5F7;
                border-left: 3px solid #6B1F35;
                line-height: 1.3;
                min-height: 30px;
                display: flex;
                align-items: center;
                border-radius: 2px;
                font-weight: 500;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
              }
              
              .amount-section {
                background: linear-gradient(135deg, #6B1F35 0%, #4A1525 100%);
                padding: 12px 15px;
                margin: 10px 0;
                border-radius: 6px;
                box-shadow: 0 3px 8px rgba(107, 31, 53, 0.3);
                page-break-inside: avoid;
              }
              
              .amount-grid {
                width: 100%;
              }
              
              .amount-left {
                width: 35%;
                vertical-align: middle;
                text-align: center;
                border-right: 2px solid rgba(255,255,255,0.3);
                padding-right: 12px;
              }
              
              .amount-display {
                font-size: 26px;
                font-weight: 800;
                color: white;
                letter-spacing: 1px;
                text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
                line-height: 1.1;
              }
              
              .currency-badge {
                display: inline-block;
                background: rgba(255,255,255,0.25);
                color: white;
                padding: 3px 8px;
                font-size: 10px;
                margin-right: 4px;
                border-radius: 3px;
                font-weight: 700;
                letter-spacing: 0.5px;
              }
              
              .amount-right {
                width: 65%;
                vertical-align: middle;
                padding-left: 12px;
              }
              
              .amount-words {
                font-size: 11px;
                color: white;
                font-style: italic;
                line-height: 1.3;
                font-weight: 500;
              }
              
              .signature-section {
                margin-top: 12px;
                padding-top: 10px;
                border-top: 2px solid #6B1F35;
                page-break-inside: avoid;
              }
              
              .signature-grid {
                width: 100%;
                border-collapse: separate;
                border-spacing: 8px;
              }
              
              .signature-cell {
                width: 50%;
                padding: 0;
              }
              
              .signature-box {
                border: 2px solid #6B1F35;
                padding: 8px;
                background: #FAF5F7;
                height: 65px;
                border-radius: 3px;
                position: relative;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                page-break-inside: avoid;
              }
              
              .signature-line {
                border-bottom: 2px solid #6B1F35;
                margin: 0 4px 4px;
                flex: 1;
              }
              
              .signature-name {
                font-weight: 700;
                color: #2C2C2C;
                font-size: 11px;
                text-align: center;
                line-height: 1.2;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
              }
              
              .signature-title {
                font-size: 9px;
                color: #6B1F35;
                text-align: center;
                margin-top: 2px;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.5px;
              }
              
              .recipient-box {
                border: 2px solid #6B1F35;
                background: linear-gradient(to bottom, #FAF5F7 0%, #F0E5EA 100%);
              }
              
              .pv-footer {
                background: #4A1525;
                padding: 8px 15px;
                font-size: 9px;
                color: rgba(255,255,255,0.85);
                margin-top: auto;
                border-top: 2px solid #6B1F35;
                page-break-inside: avoid;
              }
              
              .footer-grid {
                width: 100%;
              }
              
              .footer-left {
                text-align: left;
                color: rgba(255,255,255,0.85);
                line-height: 1.3;
              }
              
              .footer-right {
                text-align: right;
                color: rgba(255,255,255,0.85);
                line-height: 1.3;
              }
              
              .footer-label {
                font-weight: 700;
                color: white;
              }
              
              @media print {
                .pv-wrapper {
                  border: none;
                  max-width: 100%;
                  font-size: 11px;
                  height: 297mm;
                  max-height: 297mm;
                }
                
                .page {
                  page-break-after: avoid;
                  page-break-before: avoid;
                  margin: 0;
                  padding: 0;
                  page-break-inside: avoid;
                  max-height: 297mm;
                }
                
                .pv-body {
                  page-break-inside: avoid;
                  max-height: 255mm;
                }
                
                .signature-section {
                  page-break-inside: avoid;
                  orphans: 5;
                  widows: 5;
                }
                
                .amount-section {
                  page-break-inside: avoid;
                }
              }
                            </style>

                            <div class="pv-wrapper">
                                <!-- DOCUMENT HEADER SECTION -->
                                <div class="document-header">
                                    <table class="header-table">
                                        <tr>
                                            <td class="title-info">
                                                <div class="company-name">
                                                    <t t-esc="payment.company_id.name or ''"/>
                                                </div>
                                                <div class="document-title">
                                                    <t t-if="payment.payment_type == 'inbound'">RECEIPT VOUCHER</t>
                                                    <t t-elif="payment.payment_type == 'outbound'">PAYMENT VOUCHER</t>
                                                    <t t-else="">PAYMENT VOUCHER</t>
                                                </div>
                                                <div class="document-number">
                            NO: <t t-esc="payment.voucher_number or payment.name or 'DRAFT'"/>
                                                </div>
                                            </td>
                                            <td class="qr-section">
                                                <div class="qr-container">
                                                    <t t-if="payment.qr_code">
                                                        <img t-att-src="image_data_uri(payment.qr_code)" class="qr-code-large" alt="QR Code"/>
                                                    </t>
                                                    <t t-elif="payment.qr_code_invoice">
                                                        <img t-att-src="'data:image/png;base64,%s' % (payment.qr_code_invoice.decode('utf-8') if isinstance(payment.qr_code_invoice, bytes) else payment.qr_code_invoice)" class="qr-code-large" alt="QR Code"/>
                                                    </t>
                                                    <t t-elif="payment.qr_image">
                                                        <img t-att-src="'data:image/png;base64,%s' % (payment.qr_image.decode('utf-8') if isinstance(payment.qr_image, bytes) else payment.qr_image)" class="qr-code-large" alt="QR Code"/>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="qr-placeholder-large">QR CODE</div>
                                                    </t>
                                                </div>
                                                <div class="status-badge-container">
                                                    <t t-if="payment.state == 'posted'">
                                                        <span class="status-badge completed">POSTED</span>
                                                    </t>
                                                    <t t-elif="payment.state == 'draft'">
                                                        <span class="status-badge draft">DRAFT</span>
                                                    </t>
                                                    <t t-elif="payment.state == 'cancelled'">
                                                        <span class="status-badge cancelled">CANCELLED</span>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="status-badge pending">PENDING</span>
                                                    </t>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <!-- BODY -->
                                <div class="pv-body">
                                    <!-- Payment Information Grid - 2 Columns -->
                                    <table class="info-grid">
                                        <tr class="info-row">
                                            <td class="info-cell">
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        <t t-if="payment.payment_type == 'inbound'">Received From</t>
                                                        <t t-else="">Paid To</t>
                                                    </div>
                                                    <div class="info-value">
                                                        <t t-esc="payment.partner_id.name or 'N/A'"/>
                                                    </div>
                                                </div>
                                            </td>

                                            <td class="info-cell">
                                                <div class="info-item">
                                                    <div class="info-label">Payment Date</div>
                                                    <div class="info-value">
                                                        <t t-if="payment.date">
                                                            <span t-field="payment.date" t-options="{&quot;widget&quot;:&quot;date&quot;, &quot;format&quot;:&quot;dd/MM/yyyy&quot;}"/>
                                                        </t>
                                                        <t t-else="">Not specified</t>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr class="info-row">
                                            <td class="info-cell">
                                                <div class="info-item">
                                                    <div class="info-label">Payment Method</div>
                                                    <div class="info-value">
                                                        <t t-if="payment.payment_method_line_id">
                                                            <t t-esc="payment.payment_method_line_id.name"/>
                                                        </t>
                                                        <t t-elif="payment.journal_id">
                                                            <t t-esc="payment.journal_id.name"/>
                                                        </t>
                                                        <t t-else="">N/A</t>
                                                    </div>
                                                </div>
                                            </td>

                                            <td class="info-cell">
                                                <div class="info-item">
                                                    <div class="info-label">Transaction Type</div>
                                                    <div class="info-value">
                                                        <t t-if="payment.payment_type == 'inbound'">Receipt</t>
                                                        <t t-elif="payment.payment_type == 'outbound'">Payment</t>
                                                        <t t-else="">
                                                            <t t-esc="payment.payment_type or 'N/A'"/>
                                                        </t>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr class="info-row">
                                            <td class="info-cell" colspan="2">
                                                <div class="info-item">
                                                    <div class="info-label">Reference / Memo</div>
                                                    <div class="info-value">
                                                        <t t-if="payment.payment_reference">
                                                            <t t-esc="payment.payment_reference"/>
                                                        </t>
                                                        <t t-elif="payment.ref">
                                                            <t t-esc="payment.ref"/>
                                                        </t>
                                                        <t t-else="">No reference</t>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>

                                    <!-- Amount Section -->
                                    <div class="amount-section">
                                        <table class="amount-grid">
                                            <tr>
                                                <td class="amount-left">
                                                    <div class="amount-display">
                                                        <span class="currency-badge">
                                                            <t t-esc="payment.currency_id.name or 'AED'"/>
                                                        </span>
                                                        <t t-esc="'{:,.2f}'.format(payment.amount or 0)"/>
                                                    </div>
                                                </td>
                                                <td class="amount-right">
                                                    <div class="amount-words">
                                                        <t t-if="payment.amount and payment.currency_id">
                                                            <t t-esc="payment.currency_id.amount_to_text(payment.amount).replace('and Zero Cent','').replace('Dirham','Dirhams').strip()"/>
                                                        </t>
                                                        <t t-else="">Zero</t>
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>

                                    <!-- Signatures - Compact 2x2 Grid -->
                                    <div class="signature-section">
                                        <table class="signature-grid">
                                            <tr>
                                                <td class="signature-cell">
                                                    <div class="signature-box">
                                                        <div class="signature-line"/>
                                                        <div>
                                                            <div class="signature-name">
                                                                <t t-if="payment.reviewer_id">
                                                                    <t t-esc="payment.reviewer_id.name"/>
                                                                </t>
                                                                <t t-else="">___________</t>
                                                            </div>
                                                            <div class="signature-title">Reviewed</div>
                                                        </div>
                                                    </div>
                                                </td>

                                                <td class="signature-cell">
                                                    <div class="signature-box">
                                                        <div class="signature-line"/>
                                                        <div>
                                                            <div class="signature-name">
                                                                <t t-if="payment.approver_id">
                                                                    <t t-esc="payment.approver_id.name"/>
                                                                </t>
                                                                <t t-else="">___________</t>
                                                            </div>
                                                            <div class="signature-title">Approved</div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="signature-cell">
                                                    <div class="signature-box">
                                                        <div class="signature-line"/>
                                                        <div>
                                                            <div class="signature-name">
                                                                <t t-if="payment.authorizer_id">
                                                                    <t t-esc="payment.authorizer_id.name"/>
                                                                </t>
                                                                <t t-else="">___________</t>
                                                            </div>
                                                            <div class="signature-title">Authorized</div>
                                                        </div>
                                                    </div>
                                                </td>

                                                <td class="signature-cell">
                                                    <div class="signature-box recipient-box">
                                                        <div class="signature-line"/>
                                                        <div>
                                                            <div class="signature-name">
                                                                <t t-esc="payment.partner_id.name or '___________'"/>
                                                            </div>
                                                            <div class="signature-title">Received By</div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>

                                <!-- FOOTER -->
                                <div class="pv-footer">
                                    <table class="footer-grid">
                                        <tr>
                                            <td class="footer-left" style="width: 70%;">
                                                <span class="footer-label">Ref:</span>
                                                <t t-esc="payment.voucher_number or payment.name or 'N/A'"/>
                                            </td>
                                            <td class="footer-right" style="width: 30%;">
                                                <span class="footer-label">Created By:</span>
                                                <t t-esc="payment.create_uid.name or 'N/A'"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>
